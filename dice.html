<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dice Roll Game - Ambar</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style/tool.css">
    <link rel="stylesheet" href="style/dice.css">

</head>
<body>
    
    <div class="game-container">
        <div class="betting-section" id="betting-section">
            <h2 class="betting-title">Place Your Bet</h2>
            <div class="bet-options">
                <button class="bet-btn" data-bet="5">5</button>
                <button class="bet-btn" data-bet="15">15</button>
                <button class="bet-btn" data-bet="30">30</button>
                <button class="bet-btn" data-bet="60">60</button>
                <button class="bet-btn" data-bet="150">150</button>
                <button class="bet-btn" id="all-in-btn">All In</button>
            </div>
            <div class="custom-bet">
                <input type="number" id="custom-bet-input" placeholder="Custom amount" min="1">
            </div>
            <button class="start-game-btn" id="start-game-btn">Start Game</button>
        </div>
        
        <div class="game-area" id="game-area">
            <div class="round-info">
                <div class="bet-display">Current Bet: <span id="current-bet">0</span> coins</div>
                <div class="progress-section">
                    <div>Win Rate: <span id="win-rate">0%</span></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                </div>
            </div>
            
            <div class="prediction-section">
                <h3 class="prediction-title">Make Your Prediction</h3>
                <div class="prediction-options">
                    <button class="prediction-btn" data-prediction="1">
                        <span>1</span>
                        <span class="prediction-odds">6x</span>
                    </button>
                    <button class="prediction-btn" data-prediction="2">
                        <span>2</span>
                        <span class="prediction-odds">6x</span>
                    </button>
                    <button class="prediction-btn" data-prediction="3">
                        <span>3</span>
                        <span class="prediction-odds">6x</span>
                    </button>
                    <button class="prediction-btn" data-prediction="4">
                        <span>4</span>
                        <span class="prediction-odds">6x</span>
                    </button>
                    <button class="prediction-btn" data-prediction="5">
                        <span>5</span>
                        <span class="prediction-odds">6x</span>
                    </button>
                    <button class="prediction-btn" data-prediction="6">
                        <span>6</span>
                        <span class="prediction-odds">6x</span>
                    </button>
                    <button class="prediction-btn" data-prediction="even">
                        <span>Even</span>
                        <span class="prediction-odds">2x</span>
                    </button>
                    <button class="prediction-btn" data-prediction="odd">
                        <span>Odd</span>
                        <span class="prediction-odds">2x</span>
                    </button>
                    <button class="prediction-btn" data-prediction="high">
                        <span>High (4-6)</span>
                        <span class="prediction-odds">2x</span>
                    </button>
                    <button class="prediction-btn" data-prediction="low">
                        <span>Low (1-3)</span>
                        <span class="prediction-odds">2x</span>
                    </button>
                </div>
                <button class="roll-dice-btn" id="roll-dice-btn" disabled>Roll The Dice!</button>
            </div>
            
            <div class="status-message" id="status-message">Select your prediction to roll the dice</div>
            
            <div class="dice-section">
                <h3 class="section-title">Dice Result</h3>
                <div class="dice-container">
                    <div class="dice" id="game-dice">?</div>
                </div>
            </div>
        </div>
        
        <div class="result-popup" id="result-popup">
            <div class="popup-content">
                <h2 class="result-title" id="result-title">Round Complete!</h2>
                <div class="result-amount" id="result-amount">+0 coins</div>
                <div class="result-details" id="result-details"></div>
                <button class="next-game-btn" id="next-game-btn">Play Again</button>
            </div>
        </div>
    </div>
    
    <script src="tool.js"></script>
    <script>
        class DiceRollGame {
            constructor() {
                this.currentBet = 0;
                this.currentPrediction = null;
                this.gameInProgress = false;
                this.gamesPlayed = 0;
                this.gamesWon = 0;
                
                this.initializeEventListeners();
                this.updateDisplay();
            }
            
            initializeEventListeners() {
                // Bet buttons
                document.querySelectorAll('.bet-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.bet-btn').forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                        
                        if (btn.id === 'all-in-btn') {
                            this.currentBet = AmbarHeader.getCurrency('coins');
                            document.getElementById('custom-bet-input').value = this.currentBet;
                        } else {
                            this.currentBet = parseInt(btn.dataset.bet);
                            document.getElementById('custom-bet-input').value = this.currentBet;
                        }
                        
                        this.validateBet();
                    });
                });
                
                // Custom bet input
                const customBetInput = document.getElementById('custom-bet-input');
                customBetInput.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value) || 0;
                    this.currentBet = value;
                    document.querySelectorAll('.bet-btn').forEach(b => b.classList.remove('selected'));
                    this.validateBet();
                });
                
                // Start game button
                document.getElementById('start-game-btn').addEventListener('click', () => {
                    this.startGame();
                });
                
                // Prediction buttons
                document.querySelectorAll('.prediction-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.prediction-btn').forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                        this.currentPrediction = btn.dataset.prediction;
                        document.getElementById('roll-dice-btn').disabled = false;
                    });
                });
                
                // Roll dice button
                document.getElementById('roll-dice-btn').addEventListener('click', () => {
                    this.rollDice();
                });
                
                // Next game button
                document.getElementById('next-game-btn').addEventListener('click', () => {
                    this.nextGame();
                });
                
                // Close popup on outside click
                document.getElementById('result-popup').addEventListener('click', (e) => {
                    if (e.target === e.currentTarget) {
                        this.nextGame();
                    }
                });
            }
            
            updateDisplay() {
                const allInBtn = document.getElementById('all-in-btn');
                if (allInBtn) {
                    allInBtn.textContent = `All In (${AmbarHeader.getCurrency('coins')})`;
                }
            }
            
            validateBet() {
                const startBtn = document.getElementById('start-game-btn');
                const playerCoins = AmbarHeader.getCurrency('coins');
                const isValid = this.currentBet > 0 && this.currentBet <= playerCoins;
                
                startBtn.disabled = !isValid;
                startBtn.textContent = isValid ? 'Start Game' : 
                    (this.currentBet > playerCoins ? 'Insufficient Coins' : 'Enter Bet Amount');
            }
            
            startGame() {
                if (this.currentBet <= 0 || this.currentBet > AmbarHeader.getCurrency('coins') || this.gameInProgress) return;
                
                this.gameInProgress = true;
                AmbarHeader.updateCurrency('coins', -this.currentBet);
                
                document.getElementById('betting-section').style.display = 'none';
                document.getElementById('game-area').style.display = 'block';
                document.getElementById('current-bet').textContent = this.currentBet.toLocaleString();
                
                this.resetGame();
            }
            
            resetGame() {
                this.currentPrediction = null;
                
                // Reset UI
                document.querySelectorAll('.prediction-btn').forEach(btn => btn.classList.remove('selected'));
                document.getElementById('roll-dice-btn').disabled = true;
                document.getElementById('game-dice').textContent = '?';
                document.getElementById('game-dice').className = 'dice';
                document.getElementById('status-message').textContent = 'Select your prediction to roll the dice';
                
                this.updateProgressDisplay();
            }
            
            updateProgressDisplay() {
                const winRate = this.gamesPlayed > 0 ? Math.round((this.gamesWon / this.gamesPlayed) * 100) : 0;
                document.getElementById('win-rate').textContent = `${winRate}%`;
                document.getElementById('progress-fill').style.width = `${winRate}%`;
            }
            
            rollDice() {
                if (!this.currentPrediction) return;
                
                const dice = document.getElementById('game-dice');
                const rollBtn = document.getElementById('roll-dice-btn');
                
                rollBtn.disabled = true;
                dice.classList.add('rolling');
                dice.textContent = '🎲';
                
                document.getElementById('status-message').textContent = 'Rolling...';
                
                // Simulate dice roll animation
                let rollCount = 0;
                const rollInterval = setInterval(() => {
                    dice.textContent = Math.floor(Math.random() * 6) + 1;
                    rollCount++;
                    
                    if (rollCount >= 8) {
                        clearInterval(rollInterval);
                        this.finishRoll();
                    }
                }, 150);
            }
            
            finishRoll() {
                const dice = document.getElementById('game-dice');
                const finalResult = Math.floor(Math.random() * 6) + 1;
                
                dice.textContent = finalResult;
                dice.classList.remove('rolling');
                
                const isWinner = this.checkWin(finalResult, this.currentPrediction);
                const multiplier = this.getMultiplier(this.currentPrediction);
                
                if (isWinner) {
                    dice.classList.add('winner');
                    document.getElementById('status-message').textContent = `You won! Rolled ${finalResult}`;
                } else {
                    dice.classList.add('loser');
                    document.getElementById('status-message').textContent = `You lost. Rolled ${finalResult}`;
                }
                
                this.gamesPlayed++;
                if (isWinner) this.gamesWon++;
                
                setTimeout(() => {
                    this.endGame(finalResult, isWinner, multiplier);
                }, 2000);
            }
            
            checkWin(diceResult, prediction) {
                switch(prediction) {
                    case '1': case '2': case '3': case '4': case '5': case '6':
                        return diceResult === parseInt(prediction);
                    case 'even':
                        return diceResult % 2 === 0;
                    case 'odd':
                        return diceResult % 2 !== 0;
                    case 'high':
                        return diceResult >= 4;
                    case 'low':
                        return diceResult <= 3;
                    default:
                        return false;
                }
            }
            
            getMultiplier(prediction) {
                switch(prediction) {
                    case '1': case '2': case '3': case '4': case '5': case '6':
                        return 6;
                    case 'even': case 'odd': case 'high': case 'low':
                        return 2;
                    default:
                        return 1;
                }
            }
            
            endGame(diceResult, isWinner, multiplier) {
                const reward = isWinner ? Math.round(multiplier * this.currentBet) : 0;
                const netResult = reward - this.currentBet;
                
                // Update currencies
                AmbarHeader.updateCurrency('coins', reward);
                
                // Update game stats
                this.updateGameStats(isWinner ? 100 : 0, netResult);
                
                this.showResults(netResult, diceResult, isWinner, multiplier, reward);
                this.gameInProgress = false;
            }
            
            updateGameStats(winPercentage, coinsEarned) {
                // Update localStorage stats for game.html integration
                const currentGames = parseInt(localStorage.getItem('luckGamesPlayed') || '0') + 1;
                const currentCoins = parseInt(localStorage.getItem('luckCoinsEarned') || '0') + coinsEarned;
                const currentWinRate = parseFloat(localStorage.getItem('totalWinRate') || '0');
                
                const newWinRate = currentGames > 0 ? 
                    ((currentWinRate * (currentGames - 1)) + winPercentage) / currentGames : winPercentage;
                
                localStorage.setItem('luckGamesPlayed', currentGames);
                localStorage.setItem('luckCoinsEarned', currentCoins);
                localStorage.setItem('totalWinRate', newWinRate);
                localStorage.setItem('luck', Math.round(newWinRate));
            }
            
            showResults(netResult, diceResult, isWinner, multiplier, reward) {
                const popup = document.getElementById('result-popup');
                const title = document.getElementById('result-title');
                const amount = document.getElementById('result-amount');
                const details = document.getElementById('result-details');
                
                if (netResult > 0) {
                    title.textContent = 'You Won!';
                    amount.textContent = `+${netResult.toLocaleString()} coins`;
                    amount.className = 'result-amount positive';
                } else {
                    title.textContent = 'You Lost';
                    amount.textContent = `${netResult.toLocaleString()} coins`;
                    amount.className = 'result-amount negative';
                }
                
                const predictionText = this.getPredictionText(this.currentPrediction);
                
                details.innerHTML = `
                    <p><strong>Dice Result:</strong> ${diceResult}</p>
                    <p><strong>Your Prediction:</strong> ${predictionText}</p>
                    <p><strong>Bet:</strong> ${this.currentBet.toLocaleString()} | <strong>Reward:</strong> ${reward.toLocaleString()}</p>
                    <p><strong>Multiplier:</strong> ${multiplier}x</p>
                `;
                
                popup.style.display = 'flex';
            }
            
            getPredictionText(prediction) {
                const predictionMap = {
                    '1': 'Number 1', '2': 'Number 2', '3': 'Number 3',
                    '4': 'Number 4', '5': 'Number 5', '6': 'Number 6',
                    'even': 'Even Numbers', 'odd': 'Odd Numbers',
                    'high': 'High (4-6)', 'low': 'Low (1-3)'
                };
                return predictionMap[prediction] || prediction;
            }
            
            nextGame() {
                document.getElementById('result-popup').style.display = 'none';
                document.getElementById('game-area').style.display = 'none';
                document.getElementById('betting-section').style.display = 'block';
                
                // Reset bet selection
                document.querySelectorAll('.bet-btn').forEach(b => b.classList.remove('selected'));
                document.getElementById('custom-bet-input').value = '';
                this.currentBet = 0;
                this.updateDisplay();
                this.validateBet();
                
                // Check if player has enough coins for minimum bet
                if (AmbarHeader.getCurrency('coins') < 5) {
                    this.showGameOverModal();
                }
            }
            
            showGameOverModal() {
                const popup = document.getElementById('result-popup');
                const title = document.getElementById('result-title');
                const amount = document.getElementById('result-amount');
                const details = document.getElementById('result-details');
                const nextBtn = document.getElementById('next-game-btn');
                
                title.textContent = 'Game Over!';
                amount.textContent = 'Insufficient Coins';
                amount.className = 'result-amount negative';
                details.innerHTML = `
                    <p>You need at least 5 coins to play.</p>
                    <p>Visit the store or play other games to earn more coins!</p>
                `;
                nextBtn.textContent = 'Go Back';
                
                popup.style.display = 'flex';
                
                nextBtn.onclick = () => {
                    AmbarNavigation.navigateTo('games');
                };
            }
        }
        
        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize header with back button
            AmbarHeader.init({
                showCurrencies: ['coins', 'luck'],
                showSettings: false,
                showBackButton: true
            });
            
            // Override back button to go to games page
            AmbarHeader.goBack = () => {
                AmbarNavigation.navigateTo('games');
            };
            
            AmbarNavigation.setActivePage('games');
            
            new DiceRollGame();
        });
    </script>
</body>
</html>